# Rocket Game Launcher (v1.0.0). Руководство пользователя. 

## Краткое описание
Программа предназначена для запуска игр и настройки параметров из конфигурационных файлов игры. В первую очередь программа интересна тем, кто занимается разработкой сборок на основе какой-либо игры. Разрабатывалась для сборки **Oblivion Association** на основе **TES4: Oblivion**, затем была доработана для использования с другими играми. Присутствует поддержка Mod Organizer версии 1 и 2.

## Основные возможности
Программа имеет следующие основные возможности:
- Запуск игры с указанием параметров(аргументов) запуска.
- Запуск других приложений с указанием параметров(аргументов) запуска.
- Управление параметрами из конфигурационных `.ini` и `.xml` файлов с помощью UI элементов (селектов, ползунков и т.д.).
- Создание и управление бэкапами конфигурационных файлов, параметры которых используются для редактирования в программе.
- Изменение профиля Mod Organizer.

## Установка
Программа является портативной (portable) и не требует установки. Просто скопируйте папку **Rocket Game Launcher** в корневую (и только туда) папку с игрой.

## Рекомендации
Для комфортной работы с конфигурационными файлами программы, которые имеют расширение `.json`, настоятельно рекомендуется использовать текстовые редакторы с подсветкой синтаксиса, например, NotePad++. Так как синтаксис этого формата строгий, это убережет от синтаксических ошибок на этапе изменения файлов.

## Переменные путей
В программе используются переменные путей для упрощения работы с конфигурационными файлами. Эти переменные могут использоваться в `config.json` и `settings.json` в путях к папкам и файлам. Заранее предопределены **пять** переменных, одна из которых доступна всегда, три других зависят от указанных параметров в `config.json`.
1. **%GAME_DIR%**. Доступна всегда. Путь до папки с игрой.
2. **%DOCUMENTS%**. Путь до папки Documents в папке пользователя ОС. Доступна, если в `config.json` указано значение в поле ***documentsPath***.
3. **%MO_DIR%**. Путь до папки Mod Organizer. Доступна, если используется МО, т.е. в `config.json` в объекте **modOrganizer** значение поля ***isUsed*** равно *true*.
4. **%MO_MODS%**. Путь до папки модов Mod Organizer. Доступна, если используется МО, т.е. в `config.json` в объекте **modOrganizer** значение поля ***isUsed*** равно *true*.
5. **%MO_PROFILE%**. Путь до папки текущего профиля Mod Organizer. Доступна, если используется МО, т.е. в `config.json` в объекте **modOrganizer** значение поля ***isUsed*** равно *true*.

Допустим, игра установлена по следующему пути: *D:\Games\Oblivion*. Тогда переменная **%GAME_DIR%** будет иметь значение этого пути. Если ипользуется Mod Organizer, то переменная **%MO_DIR%** будет иметь путь *D:\Games\Oblivion\\{имя_папки_МО}*, **%MO_PROFILE%** будет иметь путь *D:\Games\Oblivion\\{имя_папки_МО}\profiles\\{имя_профиля_МО}*.

Значение переменной **%DOCUMENTS%**, если в ***documentsPath*** указано *MyGames\\\\Oblivion*, будет иметь значение *{системный_диск}\Users\{имя_пользователя}\Documents\MyGames\Oblivion*

Помимо этого можно создавать свои пути. Для этого предназначено поле **customPaths** в `config.json`. Это объект, у которого ключ - имя переменной, значение - путь до папки. Имена переменных должны иметь вид **%VARIABLE_NAME%**. Пути указываются с отчетом от корневой папки игры. Использование других переменных пути при создании своих переменных не допускается.

> Пользовательские пути не могут выходить по иерархии выше корневой папки игры.

Если создана переменная **%DATA%**, со значением *Data\\\\OBSE\\\\Plugins*, что эквивалентно *%GAME_DIR%\\\\Data\\\\OBSE\\\\Plugins* то итоговое значение ее пути будет *D:\Games\Oblivion\Data\OBSE\Plugins*.

> Все пути, в переменных и значениях других полей, пишутся с двойным обратным слешем, например *Data\\\\OBSE\\\\Plugins*. Это связано с системой обработки строк. Обратный слэш (**\\**) является спецсимволом, и в строках должен экранироваться, иначе будет проигнорирован, и в итоге получится некорректный путь. При использовании текстового редактора с подсветкой синтаксиса вы увидите ошибку, если **\\** не будет экранирован.

> О кириллице в путях. Настоятельно рекомендуется **не использовать** в путях кириллицу (буквы русского алфавита). Некоторые программы имеют проблемы с такими путями. Это не требование конкретно этой программы, это общая рекомендация, которая относится к любой программе.

## Настройка
Программа имеет два основных конфигурационных файла: `config.json` и `settings.json`.

### config.json
Файл `config.json` - основной конфигурационный файл программы. Содержит в себе настройки размеров окна, настройку параметров Mod Organizer, пути к исполняемым программам. 

> Конфигурационный файл программы по умолчанию настроен для "чистой" **TES4: Oblivion**.

Порядок полей может быть произвольным. Все поля опциональные, за исключением ***playButton***. Если какое-то из полей представялет собой объект, то вложенные обязательные поля помечены отдельно.

```js
{
  // Определяет, можно ли изменять размер окна.
  // Тип: булево значение.
  // По умолчанию: false.
  "isResizable": false,

  // Определяет минимальное значение ширины окна программы в пикселях.
  // Игнорируется, если `isResizable` в значении false.
  // Тип: число.
  // По умолчанию: 0 (нет ограничений).
  "minWidth": 400,

  // Определяет минимальное значение высоты окна программы в пикселях.
  // Игнорируется, если `isResizable` в значении false.
  // Тип: число.
  // По умолчанию: 0 (нет ограничений).
  "minHeight": 400,

  // Определяет ширину окна программы в пикселях.
  // Если `isResizable` = false, то это значение ширины будет постоянным.
  // Если `isResizable` = true, то это значение ширины до первого его изменения.
  // Тип: число.
  // По умолчанию: 800.
  "width": 800,

  // Определяет высоту окна программы в пикселях.
  // Если `isResizable` = false, то это значение высоты будет постоянным.
  // Если `isResizable` = true, то это значение высоты до первого его изменения.
  // Тип: число.
  // По умолчанию: 600.
  "height": 600,

  // Определяет максимальное значение ширины окна программы в пикселях.
  // Игнорируется, если `isResizable` в значении false.
  // Тип: число.
  // По умолчанию: 0 (нет ограничений).
  "maxWidth": 0,

  // Определяет максимальное значение высоты окна программы в пикселях.
  // Игнорируется, если `isResizable` в значении false.
  // Тип: число.
  // По умолчанию: 0 (нет ограничений).
  "maxHeight": 0,

  // Переменные пользовательских путей. См. раздел "Переменные путей".
  // Тип: объект.
  // По умолчанию: {} (пустой объект).
  "customPaths": {
    "%CUSTOM%": "Data\\OBSE\\Plugins",
  },

  // Настройки для Mod Organizer.
  // Определяют, используется ли МО, его версия и путь до папки МО.
  // Тип: объект.
  // По умолчанию: { isUsed: true }.
  "modOrganizer": {
    // Используется ли МО.
    // Тип: булево значение.
    // По умолчанию: false.
    // Обязательное поле.
    "isUsed": true,

    // Версия МО.
    // Тип: число.
    // По умолчанию: 2.
    // Доступные значения: 1, 2.
    "version": 2,

    // Путь до папки МО.
    // Тип: строка.
    // По умолчанию: "Mod Organizer".
    "path": "MO2"
  },

  // Путь до папки игровых файлов в папке Documents пользователя Windows.
  // Тип: строка.
  // По умолчанию: "" (пустая строка).
  "documentsPath": "My Games\\Oblivion",
  
  // Имя игры. Будет отображаться в заголовке окна программы.
  // Тип: строка.
  // По умолчанию: "" (пустая строка).
  "gameName": "Oblivion Association",

  // Настройка поведения кнопки запуска игры.
  // Тип: объект.
  // Обязательное поле.
  "playButton": {
    // Путь до исполняемого файла игры. `.exe` или `.lnk`(ярлык).
    // Тип: строка.
    // По умолчанию: "" (пустая строка).
    // Обязательное поле.
    "path": "Oblivion.exe",

    // Параметры запуска приложения.
    // Игнорируются, если в `path` указан путь до ярлыка (.lnk).
    // Тип: массив строк.
    // По умолчанию: [] (пустой массив).
    "args": [
      "-editor"
    ],

    // Заголовок, отображаемый на кнопке запуска игры.
    // Тип: строка.
    // По умолчанию: "" (пустая строка).
    // Допустимо искользовать кириллицу.
    "label": ""
  },

  // Определяет, какие доп. программы либо папки можно запускать\открывать через программу.
  // Будут выводиться в виде кнопок на главном экране программы.
  // Тип: массив объектов.
  // По умолчанию: [] (пустой массив).
  "customButtons": [
    {
      // Определяет путь до файла\папки.
      "path": "%GAME_DIR%\\Editor.lnk",

      // Параметры запуска приложения.
      // Тип: массив строк.
      // По умолчанию: [] (пустой массив).
      "args": [],

      // Заголовок кнопки.
      // Тип: строка.
      // По умолчанию: "" (пустая строка).
      // Допустимо искользовать кириллицу.
      // Обязательное поле.
      "label": "CSE"
    }
  ]
}
```

Более подробно остановимся на полях ***playButton*** и ***customButtons***. 

***playButton*** определяет то, какой исполняемый файл будет запускаться по кнопке "Играть" (если не указано поле ***label***, то это будет стандартный заголовок кнопки). Значением может быть путь до `.exe` или `.lnk` файла. От расширения файла зависит, какие  аргументы запуска можно передать. Если для запуска игры не требуется каких-либо особых условий, то нет принципиального значения, какой файл для запуска будет указан. Однако в более сложных случаях возможностей запуска через ярлык может быть недостаточно ввиду его ограничений. Основное - это сохранение пути в поле "Объект" в свойствах ярлыка. Если он был прописан, то он всегда будет таким, как при создании, и если у пользователя игра будет установлена на другой диск, то будет ошибка. Поэтому в данном случае следует указывать путь до `.exe` файла, а параметры запуска передавать через поле ***args***.

Рассмотрим на примере Mod Organizer 1. При его использовании игру следует запускать через него, иначе игра не увидит установленные плагины. Для облегчения запуска игры и приложений, работающих с модами, в МО можно создать ярлыки. Поле "Объект" в ярлыке для запуска игры будет выглядеть следующим образом: *"D:\Games\Oblivion\Mod Organizer\ModOrganizer.exe" "D:\Games\Oblivion\Oblivion.exe".exe"*. И если этот ярлык запустить на другом ПК, где другая иерархия папок, то игра не запустится.

В таких случаях нужно прописывать запуск через `.exe`. Для этого в поле ***path*** пишем путь до `.exe`. Добавление ***%GAME_DIR%*** в ***path*** не обязательно, т.к., по умолчанию, все пути начинают отсчет от папки игры.

> Однако, в агрументах путь до файла/папки **ОБЯЗАТЕЛЬНО** должен начинаться с ***%GAME_DIR%***, иначе аргумент будет распознан как обычная строка, а не путь.

В поле ***args*** добавляем нужные аргументы. Для случая с Mod Organizer итоговая запись будет выглядеть так:

```js
{
  "path": "Mod Organizer\\ModOrganizer.exe",
  "args": ["%GAME_DIR%\\Oblivion.exe"],
  "label": "Любое_Имя_Для_Кнопки"
}
```
или так 
```js
{
  "path": "%GAME_DIR%\\Mod Organizer\\ModOrganizer.exe",
  "args": ["%GAME_DIR%\\Oblivion.exe"],
  "label": "Любое_Имя_Для_Кнопки"
}
```
Если нужно добавить еще какой-либо параметр, то пишем его через запятую:
```js
"args": ["%GAME_DIR%\\Oblivion.exe", "-editor"],
```
Аналогичный подход используется и для ***customButtons***. Отличие лишь в том, что это массив объектов, каждый элемент которого - описание для кнопки.
```js
"customButtons": [
  {
    "path": "Mod Organizer",
    // или "path": "%MO_DIR"%, что равнозначно
    "label": "Открыть папку МО"
  },
  {
    "path": "%MO_DIR%\\ModOrganizer.exe",
    "args": ["%GAME_DIR%\\obse_loader.exe", "-editor"],
    "label": "Construction Set Extender"
  },
  {
    "path": "%GAME_DIR%",
    "label": "Открыть папку игры"
  },
  {
    // Так же допускается использование своих кастомных путей, если такие созданы.
    "path": "%MY_CUSTOM_PATH%\\AnyProgram.lnk",
    // В случае использования `.lnk` параметры в "args" игнорируются и используются параметры из ярлыка.
    "args": [],
    "label": "Какое-то приложение"
  }
],
```

### settings.json
Файл `settings.json` отвечает за вывод на экран настроек опций игры, основанных на параметрах из конфигурационных файлов игры. Конфигурационные файлы - это файлы с расширением `.ini`, `.xml` и другие, которые имеют схожую с ними структуру содержимого, проще говоря текст. О расширениях файлов и их структуре более подробно будет описано ниже. Конфигурационными файлами чаще всего являются файлы из модов(плагинов), которые отвечают за регулировку работы мода. Но так же это могут быть и встроенные конфигурационные файлы игры, доступные для редактирования, такие как `oblivion.ini`. 

Имеет три оснвных поля:

```js
{
  // Доступные группы для параметров.
  // Тип: массив объектов.
  // По умолчанию: [] (пустой массив).
  "gameSettingsGroups": [
    {
      // Техническое название группы.
      // Служит для определения принадлежности параметров к группам.
      // Значение не должно поваторяться в других группах.
      // Тип: строка.
      // Обязательное поле.
      "name": "Graphic",

      // Заголовок для вкладки на экране настроек.
      // Тип: строка.
      // По умолчанию: значение поля "name".
      // Допустимо искользовать кириллицу.
      "label": "Графика"
    }
  ],

  // Базовая кодировка для конфигурационных файлов игры.
  // Тип: строка.
  // По умолчанию: "win1251".
  "baseFilesEncoding": "win1251",

  // Описание используемых конфигурационных файлов игры и параметров из них.
  // Тип: объект.
  // Обязательное поле.
  "gameSettingsFiles": {}
}
```
Поле ***gameSettingsGroups*** отвечает за то, какие группы настроек будут доступны в программе. Группы служат для объединения выводимых на экран параметров, что повышает удобство поиска нужных. Количество групп может быть любым. При переключении вкладок будут отображены только те параметры, у которых указана та же самая группа. Если группы не созданы, все параметры будут отображены в общем списке.

Поле ***baseFilesEncoding*** определяет базовую кодировку конфигурационных файлов игры. Она будет использована, если для файла не указана своя. По умолчанию используется "win1251" - кодировка с поддержкой кириллицы. Если при изменении параметров какого-либо файла через программу в этом файле вместо читаемых слов появились непонятные символы, значит выбрана неверная кодировка для файла. Все доступные кодировки вы можете посмотреть [здесь](https://github.com/ashtuchkin/iconv-lite/wiki/Supported-Encodings).

Поле ***gameSettingsFiles*** отвечает за описание используемых для редактирования в программе параметров из конфигурационных файлов игры, а так же самого файла, откуда взяты параметры. Представляет собой объект, в котором все ключи должны быть уникальными. Этот объект содержит в себе другие объекты. Каждый отдельный файл, используемый в программе, это отдельный объект. Рекомендуется (но это не обязательно) называть ключи по шаблону *имя_файла.расширение_файла* в CamelCase нотации. Например:

```js
  "OblivionIni": {},
  "SomeFileXml": {}
```
Каждый объект файла содержит три основных поля:
```js
{
  // Путь к файлу.
  // Тип: строка.
  // Обязательное поле.
  "path": "oblivion.ini",

  // Вид содержимого файла (об этом ниже).
  // Тип: строка.
  // Доступные значения: "sectional", "line", "tag".
  // Обязательное поле.
  "view": "sectional",

  // Список опций, генерируемых на основе параметров из файла.
  // Тип: массив объектов.
  // Обязательное поле.
  "optionsList": [
}
```

Поле ***path*** содержит в себе путь к файлу. Пути начинают отсчет от корневой папки игры, если не указана переменная пути.

Если файл, из которого требуется взять настройки, находится в папке файлов, расположенной в Documents пользователя, то путь должен начинаться с **%DOCUMENTS%**.
```js
  "path": "%DOCUMENTS%\\oblivion.ini",
```
Аналогично с файлами из папки профиля Mod Organizer. Путь к этим файлам должен начинаться с **%MO_PROFILE%**.
```js
  "path": "%MO_PROFILE%\\oblivion.ini",
```
Имя папки профиля определяется автоматически по активному профилю в `ModOrganizer.ini`. Активный профиль МО можно изменить в программе.

Поле ***view*** задается в соответствии со структурой содержимого файла. Поддерживается три вида структур, которые программа может обрабатывать: *line*, *sectional* и *tag*.

Структура *line* используется в `.ini` файлах и представляет собой последовательность строк вида:
```ini
set имя_параметра to значение_параметра
```
Пример такого файла - `Maskar Oblivion Overhaul.ini`.

Структура *sectional* это классическая структура для `.ini` файла. Имеет вид:
```ini
[имя_группы]
имя_параметра=значение_параметра
```
Пример такого файла - `oblovion.ini`.

Структура *tag* это структура, идентичная таковой из `.xml` файлов. 
```xml
<Section>
  <Data Value="5" />
</Section>
```
Пример такого файла это любой файл с расширением `.xml`. Касательно Oblivion, подобную структуру имеет конфигурационный файл `OblivionReloaded.dll.config`.

> Исходя из вышеописанного, поле ***view*** заполняется в соответствии со структурой содержимого файла, а не его расширением.

Поле ***optionsList*** описывает доступные опции на экране настроек. Представляет собой массив, каждый элемент которого объект с описанием опции. Опции имеют **четыре** типа:
{
  "OblivionIni": {
      "path": "%DOCUMENTS%\\oblivion.ini",
      "view": "sectional",
      "optionsList": [
        {
          "parameterType": "combined",
          "label": "Разрешение экрана",
          "description": "Устанавливает разрешение экрана",
          "controllerType": "select",
          "separator": ":",
          "options": {
            "640:480": "640 x 480",
            "800:600": "800 x 600",
            "1024:768": "1024 x 768",
            "1280:720": "1280 x 720",
            "1280:800": "1280 x 800",
            "1280:1024": "1280 x 1024",
            "1366:768": "1366 x 768",
            "1440:900": "1440 x 900",
            "1600:1200": "1600 x 1200",
            "1680:1050": "1680 x 1050",
            "1920:1080": "1920 x 1080",
            "1920:1200": "1920 x 1200",
            "2560:1440": "2560 x 1440",
            "2560:1600": "2560 x 1600",
            "3840:2160": "3840 x 2160"
          },
          "items": [
            {
              "name": "iSize W",
              "iniGroup": "Display"
            },
            {
              "name": "iSize H",
              "iniGroup": "Display"
            }
          ]
        }
      ]
    }
}
